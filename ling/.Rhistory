library(jjmR)
library(ggplot2)
library(tidyverse)
# mod0.00 <- runit(geth("0.00"),pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjms")
getwd()
geth <- function(mod,h=hyp) paste0(h,"_", mod) # Package? Or keep?
hyp=1
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
plot(m0, var="SSB") # only SSB
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
setwd("~/_mymods/sprfmo/jjmr/R")
devtools::load_all()
setwd("~/_mymods/sprfmo/jjm/assessment/ling")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
library(jjmR)
library(ggplot2)
library(tidyverse)
# mod0.00 <- runit(geth("0.00"),pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjms")
getwd()
rm(m1)
geth <- function(mod,h=hyp) paste0(h,"_", mod) # Package? Or keep?
hyp=1
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
ling
hyp="lingN"
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
setwd("~/_mymods/sprfmo/jjmr/R")
devtools::load_all()
setwd("~/_mymods/sprfmo/jjm/assessment/ling")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
library(TAF)
taf.blue
?TAF
make.all
make()
make
taf.boot()
getwd()
taf.boot()
taf.boot()
taf.boot()
getwd()
setwd("~/Chile March 2023/ling")
taf.boot()
setwd("~/_mymods/sprfmo/jjm/assessment/ling")
hyp="lingN"
library(jjmR)
library(ggplot2)
library(tidyverse)
# mod0.00 <- runit(geth("0.00"),pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjms")
getwd()
rm(m1)
geth <- function(mod,h=hyp) paste0(h,"_", mod) # Package? Or keep?
hyp="lingN"
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
library(jjmR)
library(ggplot2)
library(tidyverse)
geth <- function(mod,h=hyp) paste0(h,"_", mod) # Package? Or keep?
hyp="lingN"
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/jjms")
remotes::install_github("JBGruber/askgpt")
pak::pkg_install("JBGruber/askgpt")
library(askgpt)
login()
askgpt("how to debug an R script")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../../src/amak")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
dir.jjmR <- "~/_mymods/sprfmo/jjmR"
dir.jjm <- getwd()
library(foreach)
library(doParallel)
registerDoParallel(5)
setwd(dir.jjmR)
devtools::load_all()
setwd(dir.jjm)
getwd()
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
?devtools::load_all()
dir.jjm <- getwd()
dir.jjm
getwd()
setwd(dir.jjmR)
devtools::load_all()
setwd(dir.jjm)
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
setwd(dir.jjmR)
devtools::load_all()
setwd(dir.jjm)
m0 <- readJJM(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
m0 <- readJJM(geth("1.00"),exec="../src/amak")
m0 <- readJJM(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
setwd(dir.jjm)
m0 <- readJJM(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
getwd()
geth <- function(mod,h=hyp) paste0(h,"_", mod) # Package? Or keep?
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
setwd(dir.jjmR)
source("R/jjmr-internal.R")
setwd(dir.jjm)
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
setwd(dir.jjmR)
devtools::load_all()
setwd(dir.jjm)
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
nI
print(nI)
q
nI
cols      = list()
###-Fill cols with data from res1-###
#-Common data
cols$years        = matrix(NA, ncol = 2, nrow = 1 , dimnames = list("years", c("first year", "last year")))
cols$years[]      = na.omit(.an(unlist(res1[1:2])))
cols$ages         = matrix(NA, ncol = 2, nrow = 1, dimnames = list("age", c("age recruit", "oldest age")))
cols$ages[]       = na.omit(.an(unlist(res1[3:4])))
cols      = list()
###-Fill cols with data from res1-###
#-Common data
cols$years        = matrix(NA, ncol = 2, nrow = 1 , dimnames = list("years", c("first year", "last year")))
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/amak")
plot(m0, var="SSB") # only SSB
tidy_jjm <- tidy_JJM(m0)
selectivities <- get_selectivities(tidy_jjm)
selectivities <- get_selectivities(m0)
selectivities
plot_selectivities(selectivities)
plot_selectivities(selectivities,fleet="ind")
index_fits <- tidy_jjm$index_fits
index_fits
index_fits %>%
ggplot() +
geom_pointrange(aes(year, observed_ind, ymin = observed_ind - 1.96 * observed_se, ymax =  observed_ind + 1.96 * observed_se), alpha = 0.5) +
geom_path(aes(year, pred_ind, color = model)) +
facet_grid( fleet_name~., scales = "free_y") +
scale_x_continuous(name = "Year", guide = guide_axis(n.dodge = 2)) +
scale_y_continuous(name = "Index Values") + ggthemes::theme_few(base_size=16)
plot(m0,combine=TRUE,what='recruitment',stack=F)
plot(m0,combine=TRUE,what='ssb',stack=F)
here()
here::here()
m1 <- runit(geth("1.01"),pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjm")
getwd
getwd()
library(jjmR)
library(ggplot2)
library(tidyverse)
m1 <- runit(geth("1.01"),pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjm")
function(models) {
models = unique(models)
check = file.exists(paste0(models, ".ctl"))
if(any(!check)) {
noCtl = models[!check]
msg = paste("Ignoring non existing models:",
paste(noCtl, collapse=", "))
message(msg)
models = models[check]
}
if(length(models)<1) stop("No models to be run.")
return(models)
}
mods <- combineModels(m0,m1,m2,m3,m4)
m1 <- runit(geth("1.01"),pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjm")
mods <- combineModels(m0,m1)
m0 <- readJJM(geth("1.00"),exec="../src/jjm")
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjm")
mods <- combineModels(m0,m1)
mod <- readJJM(modnm, path = "config", input = "input")
modnm <- "model_1.00"
mod <- readJJM(modnm, path = "config", input = "input")
modnm <- "lingN_1.00"
mod <- readJJM(modnm, path = "config", input = "input")
mod_r <- mod
names(mod_r) <- modnm
Npeels<-8
ret1 <- retro(model = mod_r, n = Npeels, output = "results", exec="../src/jjm",parallel=T)
plot(ret1) # all plots
load(paste0("results/",modnm,"_retrospective.RData"))
ret<-output
dir.jjmR <- "~/_mymods/sprfmo/jjmR"
library(foreach)
library(doParallel)
registerDoParallel(8)
dir.jjm <- getwd()
setwd(dir.jjmR)
devtools::load_all()
setwd(dir.jjm)
getwd()
ret1 <- retro(model = mod_r, n = Npeels, output = "results", exec="../src/jjm",parallel=T)
ret1 <- retro(model = mod_r, n = Npeels, output = "results", exec="../src/jjm",parallel=T)
m0 <- readJJM(geth("1.00"),exec="../src/jjm")
m0 <- readJJM(geth("1.00"),exec="../src/jjm")
# mod0.00 <- runit(geth("0.00"),pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjms")
getwd()
geth <- function(mod,h=hyp) paste0(h,"_", mod) # Package? Or keep?
hyp="lingN"
m0 <- readJJM(geth("1.00"),exec="../src/jjm")
readJJM
m0 <- runit(geth("1.00") ,pdf=TRUE,portrait=F,est=TRUE,exec="../src/jjm")
mods <- combineModels(m0,m1)
names(mods)
tidy_jjm <- tidy_JJM(mods)
selectivities <- get_selectivities(tidy_jjm)
plot_selectivities(selectivities)
selectivities <- get_selectivities(tidy_jjm)
index_fits <- tidy_jjm$index_fits
index_fits
index_fits %>%
ggplot() +
geom_pointrange(aes(year, observed_ind, ymin = observed_ind - 1.96 * observed_se, ymax =  observed_ind + 1.96 * observed_se), alpha = 0.5) +
geom_path(aes(year, pred_ind, color = model)) +
facet_grid( fleet_name~., scales = "free_y") +
scale_x_continuous(name = "Year", guide = guide_axis(n.dodge = 2)) +
scale_y_continuous(name = "Index Values") + ggthemes::theme_few(base_size=16)
plot(m0,combine=TRUE,what='ssb',stack=F)
df1<-as_tibble(m0[[1]][[5]][[1]]$df1)
names(df1)<-c("type","year","est","std","lb","ub")
df<-rbind(df1 |> mutate(model="base"))
df <- df %>% mutate(
year=as.numeric(year),
est=as.numeric(est),
std=as.numeric(std),
lb =as.numeric(lb),
ub =as.numeric(ub)
)
unique(df$type)
blim <- df |> filter(type=="SSB0_Dynamic") |>  group_by(model) |> summarise(min(est))
blim
df %>%
ggplot(aes(x=year,y=est,ymin=lb,ymax=ub,color=model,fill=model)) +
geom_ribbon(alpha=.4)+ geom_line(size=.5,alpha=.5) + expand_limits(y=0) + ggthemes::theme_few() + ylab("Estimates") +
facet_wrap(type~.,scales="free")
df1<-as_tibble(m1[[1]][[5]][[1]]$df1)
names(df1)<-c("type","year","est","std","lb","ub")
df<-rbind(df1 |> mutate(model="base"))
df <- df %>% mutate(
year=as.numeric(year),
est=as.numeric(est),
std=as.numeric(std),
lb =as.numeric(lb),
ub =as.numeric(ub)
)
unique(df$type)
blim <- df |> filter(type=="SSB0_Dynamic") |>  group_by(model) |> summarise(min(est))
blim
df %>%
ggplot(aes(x=year,y=est,ymin=lb,ymax=ub,color=model,fill=model)) +
geom_ribbon(alpha=.4)+ geom_line(size=.5,alpha=.5) + expand_limits(y=0) + ggthemes::theme_few() + ylab("Estimates") +
facet_wrap(type~.,scales="free")
df1<-as_tibble(mods[[1]][[5]][[1]]$df1)
names(df1)<-c("type","year","est","std","lb","ub")
df<-rbind(df1 |> mutate(model="base"))
df <- df %>% mutate(
year=as.numeric(year),
est=as.numeric(est),
std=as.numeric(std),
lb =as.numeric(lb),
ub =as.numeric(ub)
)
unique(df$type)
blim <- df |> filter(type=="SSB0_Dynamic") |>  group_by(model) |> summarise(min(est))
blim
df %>%
ggplot(aes(x=year,y=est,ymin=lb,ymax=ub,color=model,fill=model)) +
geom_ribbon(alpha=.4)+ geom_line(size=.5,alpha=.5) + expand_limits(y=0) + ggthemes::theme_few() + ylab("Estimates") +
facet_wrap(type~.,scales="free")
df1<-as_tibble(tidy_jjm[[1]][[5]][[1]]$df1)
tidy_jjm <- tidy_JJM(mods)
ret_df <-tidy_JJM(ret1$Stock_1)
tidy_jjm <- tidy_JJM(mods)
plot(mods,combine=TRUE,what='ssb',stack=F)
plot(mods,combine=TRUE,what='recruitment',stack=F)
mod_diag <- diagnostics(mods,plot=T)
plot(mod_diag,var="ageFitsCatch")
